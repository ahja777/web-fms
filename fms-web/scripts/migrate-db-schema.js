/**
 * DB Schema Migration Script
 * Logis 등록 페이지 폼 필드와 DB 컬럼 동기화
 */

const mysql = require('mysql2/promise');

const dbConfig = {
  host: '211.236.174.220',
  port: 53306,
  user: 'user',
  password: 'P@ssw0rd',
  database: 'logstic'
};

// 마이그레이션 쿼리 목록
const migrations = [
  // 1. SHP_SHIPPING_REQUEST 컬럼 추가
  {
    name: 'SHP_SHIPPING_REQUEST - Add missing columns',
    queries: [
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS SR_DATE DATE AFTER SR_NO`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS SHIPPER_CONTACT VARCHAR(100) AFTER SHIPPER_NM`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS CONSIGNEE_CONTACT VARCHAR(100) AFTER CONSIGNEE_NM`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS CARRIER_CD VARCHAR(20) AFTER CONSIGNEE_CONTACT`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS VESSEL_NM VARCHAR(100) AFTER CARRIER_CD`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS VOYAGE_NO VARCHAR(50) AFTER VESSEL_NM`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS FINAL_DEST VARCHAR(100) AFTER DEST_PORT_CD`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS ETD_DT DATE AFTER FINAL_DEST`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS ETA_DT DATE AFTER ETD_DT`,
      `ALTER TABLE SHP_SHIPPING_REQUEST ADD COLUMN IF NOT EXISTS FREIGHT_TERMS VARCHAR(20) AFTER ETA_DT`
    ]
  },
  // 2. SHP_SHIPPING_NOTICE 컬럼 추가
  {
    name: 'SHP_SHIPPING_NOTICE - Add missing columns',
    queries: [
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS SN_DATE DATE AFTER SN_NO`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS SR_NO VARCHAR(50) AFTER SN_DATE`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS BL_NO VARCHAR(50) AFTER SR_NO`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS NOTIFY_PARTY VARCHAR(200) AFTER RECIPIENT_NM`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS FINAL_DEST VARCHAR(100) AFTER DEST_PORT_CD`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS ATD_DT DATETIME AFTER ETD_DT`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS ATA_DT DATETIME AFTER ETA_DT`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS CONTAINER_TYPE VARCHAR(10) AFTER ATA_DT`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS CONTAINER_QTY INT DEFAULT 0 AFTER CONTAINER_TYPE`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS CONTAINER_NO VARCHAR(50) AFTER CONTAINER_QTY`,
      `ALTER TABLE SHP_SHIPPING_NOTICE ADD COLUMN IF NOT EXISTS SEAL_NO VARCHAR(50) AFTER CONTAINER_NO`
    ]
  },
  // 3. QUO_QUOTE_AIR 컬럼 추가
  {
    name: 'QUO_QUOTE_AIR - Add missing columns',
    queries: [
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS EXPORT_IMPORT VARCHAR(10) DEFAULT 'EXPORT' AFTER QUOTE_DATE`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS BUSINESS_TYPE VARCHAR(20) DEFAULT 'LOCAL' AFTER EXPORT_IMPORT`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS TRADE_TERMS VARCHAR(10) DEFAULT 'CFR' AFTER BUSINESS_TYPE`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS CUSTOMER_MANAGER VARCHAR(50) AFTER CUSTOMER_ID`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS CUSTOMER_PHONE VARCHAR(30) AFTER CUSTOMER_MANAGER`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS ETD_DT DATETIME AFTER FLIGHT_NO`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS ETA_DT DATETIME AFTER ETD_DT`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS PIECES INT DEFAULT 0 AFTER VOLUME`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS CHARGEABLE_WEIGHT DECIMAL(12,2) DEFAULT 0 AFTER WEIGHT`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS HS_CODE VARCHAR(20) AFTER COMMODITY`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS DIMENSIONS VARCHAR(100) AFTER HS_CODE`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS SPECIAL_CARGO_YN CHAR(1) DEFAULT 'N' AFTER DIMENSIONS`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS DG_YN CHAR(1) DEFAULT 'N' AFTER SPECIAL_CARGO_YN`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS DG_CLASS VARCHAR(10) AFTER DG_YN`,
      `ALTER TABLE QUO_QUOTE_AIR ADD COLUMN IF NOT EXISTS UN_NUMBER VARCHAR(20) AFTER DG_CLASS`
    ]
  },
  // 4. QUO_QUOTE_AIR_FREIGHT 테이블 생성
  {
    name: 'QUO_QUOTE_AIR_FREIGHT - Create table',
    queries: [
      `CREATE TABLE IF NOT EXISTS QUO_QUOTE_AIR_FREIGHT (
        FREIGHT_ID INT AUTO_INCREMENT PRIMARY KEY,
        QUOTE_ID INT NOT NULL,
        FREIGHT_TYPE VARCHAR(10),
        FREIGHT_CODE VARCHAR(20),
        CURRENCY_CD VARCHAR(3) DEFAULT 'USD',
        EXCHANGE_RATE DECIMAL(12,4) DEFAULT 1300.0000,
        MIN_CHARGE DECIMAL(12,2) DEFAULT 0,
        RATE_45K DECIMAL(12,4) DEFAULT 0,
        RATE_100K DECIMAL(12,4) DEFAULT 0,
        RATE_300K DECIMAL(12,4) DEFAULT 0,
        RATE_500K DECIMAL(12,4) DEFAULT 0,
        RATE_OVER_500K DECIMAL(12,4) DEFAULT 0,
        VAT_YN CHAR(1) DEFAULT 'N',
        UNIT_PRICE DECIMAL(12,4) DEFAULT 0,
        AMOUNT_FOREIGN DECIMAL(15,2) DEFAULT 0,
        AMOUNT_KRW DECIMAL(15,2) DEFAULT 0,
        VAT_AMOUNT DECIMAL(15,2) DEFAULT 0,
        TOTAL_AMOUNT DECIMAL(15,2) DEFAULT 0,
        CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
        CREATED_BY VARCHAR(50),
        INDEX IDX_QUOTE_AIR_FREIGHT_QUOTE_ID (QUOTE_ID)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4`
    ]
  },
  // 5. ORD_OCEAN_BOOKING 컬럼 추가
  {
    name: 'ORD_OCEAN_BOOKING - Add missing columns',
    queries: [
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS BOOKING_TYPE VARCHAR(10) DEFAULT 'EXPORT' AFTER BOOKING_NO`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SERVICE_TYPE VARCHAR(20) DEFAULT 'CY_TO_CY' AFTER BOOKING_TYPE`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS INCOTERMS VARCHAR(10) DEFAULT 'FOB' AFTER SERVICE_TYPE`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS FREIGHT_TERMS VARCHAR(20) AFTER INCOTERMS`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS PAYMENT_TERMS VARCHAR(20) DEFAULT 'PREPAID' AFTER FREIGHT_TERMS`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_CODE VARCHAR(20) AFTER PAYMENT_TERMS`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_NM VARCHAR(100) AFTER SHIPPER_CODE`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_ADDR VARCHAR(300) AFTER SHIPPER_NM`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_CONTACT VARCHAR(50) AFTER SHIPPER_ADDR`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_TEL VARCHAR(30) AFTER SHIPPER_CONTACT`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_EMAIL VARCHAR(100) AFTER SHIPPER_TEL`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_CODE VARCHAR(20) AFTER SHIPPER_EMAIL`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_NM VARCHAR(100) AFTER CONSIGNEE_CODE`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_ADDR VARCHAR(300) AFTER CONSIGNEE_NM`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_CONTACT VARCHAR(50) AFTER CONSIGNEE_ADDR`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_TEL VARCHAR(30) AFTER CONSIGNEE_CONTACT`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_EMAIL VARCHAR(100) AFTER CONSIGNEE_TEL`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS NOTIFY_CODE VARCHAR(20) AFTER CONSIGNEE_EMAIL`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS NOTIFY_NM VARCHAR(100) AFTER NOTIFY_CODE`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS NOTIFY_ADDR VARCHAR(300) AFTER NOTIFY_NM`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS POL_TERMINAL VARCHAR(50) AFTER POL_PORT_CD`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS POD_TERMINAL VARCHAR(50) AFTER POD_PORT_CD`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS FINAL_DEST VARCHAR(100) AFTER POD_TERMINAL`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CLOSING_DT DATE AFTER ETA_DT`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS CLOSING_TIME VARCHAR(10) AFTER CLOSING_DT`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS MBL_NO VARCHAR(50) AFTER CLOSING_TIME`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS HBL_NO VARCHAR(50) AFTER MBL_NO`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS BL_TYPE VARCHAR(20) DEFAULT 'ORIGINAL' AFTER HBL_NO`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS SPECIAL_REQUEST TEXT AFTER BL_TYPE`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS DG_YN CHAR(1) DEFAULT 'N' AFTER SPECIAL_REQUEST`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS DG_CLASS VARCHAR(10) AFTER DG_YN`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS UN_NUMBER VARCHAR(20) AFTER DG_CLASS`,
      `ALTER TABLE ORD_OCEAN_BOOKING ADD COLUMN IF NOT EXISTS IMO_CLASS VARCHAR(10) AFTER UN_NUMBER`
    ]
  },
  // 6. ORD_OCEAN_BOOKING_CONTAINER 테이블 생성
  {
    name: 'ORD_OCEAN_BOOKING_CONTAINER - Create table',
    queries: [
      `CREATE TABLE IF NOT EXISTS ORD_OCEAN_BOOKING_CONTAINER (
        CONTAINER_ID INT AUTO_INCREMENT PRIMARY KEY,
        BOOKING_ID INT NOT NULL,
        CONTAINER_TYPE VARCHAR(10),
        CONTAINER_QTY INT DEFAULT 1,
        SEAL_NO VARCHAR(50),
        TARE_WEIGHT DECIMAL(12,2) DEFAULT 0,
        GROSS_WEIGHT DECIMAL(12,2) DEFAULT 0,
        MEASUREMENT DECIMAL(12,3) DEFAULT 0,
        COMMODITY VARCHAR(200),
        HS_CODE VARCHAR(20),
        REMARKS VARCHAR(500),
        CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
        INDEX IDX_OCEAN_BOOKING_CONTAINER_BOOKING_ID (BOOKING_ID)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4`
    ]
  },
  // 7. ORD_AIR_BOOKING 컬럼 추가
  {
    name: 'ORD_AIR_BOOKING - Add missing columns',
    queries: [
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS BOOKING_TYPE VARCHAR(10) DEFAULT 'EXPORT' AFTER BOOKING_NO`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SERVICE_TYPE VARCHAR(30) DEFAULT 'AIRPORT_TO_AIRPORT' AFTER BOOKING_TYPE`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS INCOTERMS VARCHAR(10) DEFAULT 'FOB' AFTER SERVICE_TYPE`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_CODE VARCHAR(20) AFTER INCOTERMS`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_NM VARCHAR(100) AFTER SHIPPER_CODE`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_ADDR VARCHAR(300) AFTER SHIPPER_NM`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_CONTACT VARCHAR(50) AFTER SHIPPER_ADDR`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_TEL VARCHAR(30) AFTER SHIPPER_CONTACT`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SHIPPER_EMAIL VARCHAR(100) AFTER SHIPPER_TEL`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_CODE VARCHAR(20) AFTER SHIPPER_EMAIL`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_NM VARCHAR(100) AFTER CONSIGNEE_CODE`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_ADDR VARCHAR(300) AFTER CONSIGNEE_NM`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_CONTACT VARCHAR(50) AFTER CONSIGNEE_ADDR`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_TEL VARCHAR(30) AFTER CONSIGNEE_CONTACT`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS CONSIGNEE_EMAIL VARCHAR(100) AFTER CONSIGNEE_TEL`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS NOTIFY_CODE VARCHAR(20) AFTER CONSIGNEE_EMAIL`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS NOTIFY_NM VARCHAR(100) AFTER NOTIFY_CODE`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS NOTIFY_ADDR VARCHAR(300) AFTER NOTIFY_NM`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS TRANSIT_PORT VARCHAR(20) AFTER DEST_PORT_CD`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS TRANSIT_TIME VARCHAR(50) AFTER TRANSIT_PORT`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS MAWB_NO VARCHAR(50) AFTER TRANSIT_TIME`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS HAWB_NO VARCHAR(50) AFTER MAWB_NO`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS SPECIAL_HANDLING VARCHAR(200) AFTER HAWB_NO`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS DG_YN CHAR(1) DEFAULT 'N' AFTER SPECIAL_HANDLING`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS DG_CLASS VARCHAR(10) AFTER DG_YN`,
      `ALTER TABLE ORD_AIR_BOOKING ADD COLUMN IF NOT EXISTS UN_NUMBER VARCHAR(20) AFTER DG_CLASS`
    ]
  },
  // 8. ORD_AIR_BOOKING_CARGO 테이블 생성
  {
    name: 'ORD_AIR_BOOKING_CARGO - Create table',
    queries: [
      `CREATE TABLE IF NOT EXISTS ORD_AIR_BOOKING_CARGO (
        CARGO_ID INT AUTO_INCREMENT PRIMARY KEY,
        BOOKING_ID INT NOT NULL,
        PIECES INT DEFAULT 0,
        PACKAGE_TYPE VARCHAR(20) DEFAULT 'CARTON',
        GROSS_WEIGHT DECIMAL(12,2) DEFAULT 0,
        CHARGEABLE_WEIGHT DECIMAL(12,2) DEFAULT 0,
        LENGTH_CM DECIMAL(10,2) DEFAULT 0,
        WIDTH_CM DECIMAL(10,2) DEFAULT 0,
        HEIGHT_CM DECIMAL(10,2) DEFAULT 0,
        VOLUME_CBM DECIMAL(12,3) DEFAULT 0,
        COMMODITY VARCHAR(200),
        HS_CODE VARCHAR(20),
        CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
        INDEX IDX_AIR_BOOKING_CARGO_BOOKING_ID (BOOKING_ID)
      ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4`
    ]
  }
];

async function runMigration() {
  let connection;
  try {
    console.log('Connecting to database...');
    connection = await mysql.createConnection(dbConfig);
    console.log('Connected successfully!\n');

    for (const migration of migrations) {
      console.log(`\n=== ${migration.name} ===`);

      for (const query of migration.queries) {
        try {
          // MariaDB/MySQL에서 IF NOT EXISTS 지원 확인
          let modifiedQuery = query;

          // ALTER TABLE ... ADD COLUMN IF NOT EXISTS는 MariaDB 10.0.2+에서 지원
          // 이전 버전에서는 컬럼 존재 여부 확인 필요
          if (query.includes('ADD COLUMN IF NOT EXISTS')) {
            // MariaDB에서 지원하므로 그대로 실행
          }

          await connection.execute(modifiedQuery);
          console.log(`  [OK] ${query.substring(0, 80)}...`);
        } catch (error) {
          // 컬럼이 이미 존재하는 경우 등 무시할 수 있는 에러
          if (error.code === 'ER_DUP_FIELDNAME' || error.message.includes('Duplicate column')) {
            console.log(`  [SKIP] Column already exists`);
          } else if (error.code === 'ER_TABLE_EXISTS_ERROR') {
            console.log(`  [SKIP] Table already exists`);
          } else {
            console.error(`  [ERROR] ${error.message}`);
          }
        }
      }
    }

    console.log('\n\nMigration completed!');

    // 결과 확인
    console.log('\n=== Verification ===');
    const tables = ['SHP_SHIPPING_REQUEST', 'SHP_SHIPPING_NOTICE', 'QUO_QUOTE_AIR',
                    'ORD_OCEAN_BOOKING', 'ORD_AIR_BOOKING', 'QUO_QUOTE_AIR_FREIGHT',
                    'ORD_OCEAN_BOOKING_CONTAINER', 'ORD_AIR_BOOKING_CARGO'];

    for (const table of tables) {
      try {
        const [columns] = await connection.execute(`SHOW COLUMNS FROM ${table}`);
        console.log(`\n${table}: ${columns.length} columns`);
      } catch (error) {
        console.log(`\n${table}: [Table not found]`);
      }
    }

  } catch (error) {
    console.error('Migration failed:', error);
  } finally {
    if (connection) {
      await connection.end();
      console.log('\nDatabase connection closed.');
    }
  }
}

runMigration();
